<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
    <head th:replace="fragments/header :: head('Crear Actor',~{::style})">
        <style>
            label{
                color: rgba(255,255,255,0.5);
            }

            #images{
                width: 90%;
                position: relative;
                margin: auto;
                display: flex;
            }
            .owl-dots{
                height: 0;
            }
        </style>
    </head>

    <body class="body">
        <!-- header -->
        <header th:replace="fragments/navbar :: admin('actores','Alonso Rosales')"></header>
        <!-- end header -->

        <div class="content" style="padding: 0">

            <div class="sign">
                <div class="container">
                    <div class="row">
                        <div class="col-12">
                            <div class="sign__content" style="margin-top: 70px">

                                <!-- authorization form -->
                                <form class="sign__form" method="post" th:action="@{/ejemplo/subir}" enctype="multipart/form-data">
                                    <h3 style="text-align: center; color: #FFFFFF; font-size: 70px; font-family: 'Open Sans', sans-serif;">Nuevo Actor</h3>

                                    <div class="row">
                                        <div class="col-md-6 col-8">

                                            <div class="sign__group">
                                                <input hidden name="id">
                                            </div>

                                            <div class="sign__group">
                                                <label for="nombre">Nombre</label>
                                                <input class="sign__input"  style="width: auto"
                                                       name="nombre" id="nombre"
                                                       placeholder="Nombre" required>
                                            </div>

                                            <div class="sign__group">
                                                <label for="nombre">Apellido</label>
                                                <input class="sign__input" style="width: auto"
                                                       name="apellido" id="apellido"
                                                       placeholder="Apellido" required>
                                            </div>
                                        </div>

                                        <!--Selector Imagenes-->
                                        <div class="col-md-6 col-12" style="padding-left: 10px">

                                            <!--Encabezado-->
                                            <section class="section section--first" style="margin: 0; padding:10px">
                                                <div class="row">
                                                    <div class="col-md-9 col-10">
                                                        <h1 class="details__title" style="font-size: 1.5rem; margin-bottom: 5px">Imágenes</h1>
                                                    </div>
                                                    <div class="col-md-3 col-2">
                                                        <button class="home__nav home__nav--next" type="button" style="margin-right: 2px">
                                                            <i class="icon ion-ios-arrow-round-forward"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            </section>

                                            <div>
                                                <div class="row align-items-center">
                                                    <div class="col-12 col-sm-12">

                                                        <!--Visor de Imagenes-->
                                                        <div class="owl-carousel photo__carousel" id="img_container"></div>

                                                        <!-- Boton para agregar imagenes -->
                                                        <div class="card__wrap">
                                                            <label class="input__btn" for="file-input" style="margin: auto;margin-top: 5px;">
                                                                Nueva Foto
                                                            </label>
                                                            <input name="imagenes" type="file" id="file-input" accept="image/png, image/jpeg"
                                                                   style="display: none" onchange="preview()" multiple>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <br>

                                    <div class="row">
                                        <div class="col-6" style="justify-content: center">
                                            <a th:href="@{/sala}" class="sign__btn">Cancelar</a>
                                        </div>

                                        <div class="col-6" style="justify-content: center">
                                            <button class="sign__btn" type="submit">Registrar
                                            </button>
                                        </div>

                                    </div>
                                </form>
                                <!-- end authorization form -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="popup" class="overlay">
            <div class="row">
                <div class="col-12">
                    <div class="sign__content">
                        <!-- authorization form -->
                        <form action="#" class="sign__form"   >
                            <a href="index.html" class="sign__logo">
                                <img src="img/tele.PNG" alt="">
                            </a>

                            <div class="sign__group">
                                <h5 style="color: white;font-size: 5rem;font-size: 25px;font-family: 'Open Sans';font-weight: 900;">
                                    Se ha creado el actor correctamente</h5>
                            </div>
                            <a th:href="@{/actor}" class="sign__btn">Continuar</a>
                        </form>
                        <!-- end authorization form -->
                    </div>
                </div>
            </div>
        </div>


        <div th:replace="fragments/footer :: js(~{::script})">
            <script>
                let fileInput = document.getElementById("file-input");
                let imgContainer = document.getElementById("img_container");

                function preview(){

                    let j=0;

                    for(i of fileInput.files){

                        let reader = new FileReader();

                        let item = document.createElement("div");
                        item.className="item";

                        // Boton de Eliminar
                        let cover = document.createElement("div");
                        cover.id=j.toString();
                        cover.className="card__cover";

                        // Activar la opción de borrar imagen
                        cover.onclick = function (){

                            const dt = new DataTransfer()

                            for (let i = 0; i < fileInput.files.length; i++) {
                                const file = fileInput.files[i];

                                if (this.id !== i.toString()) {
                                    dt.items.add(file);
                                }
                            }
                            fileInput.files = dt.files

                            imgContainer.innerHTML = "";
                            preview();
                        };

                        let button = document.createElement("a");
                        button.className = "card__play";
                        let close = document.createElement("i");
                        close.className = "bi bi-x";
                        close.setAttribute("style","color: white")

                        button.appendChild(close)
                        cover.appendChild(button)

                        reader.onload=()=>{
                            let img = document.createElement("img");
                            img.setAttribute("src",reader.result);
                            img.setAttribute("style","margin-inline: auto;max-height: 150px;max-width: fit-content;")

                            cover.appendChild(img);
                            item.appendChild(cover)
                        }
                        imgContainer.appendChild(item);
                        reader.readAsDataURL(i);
                        j++;
                    }

                    // Vuelve a cargar el deslizador
                    $('.owl-carousel').trigger('destroy.owl.carousel');
                    var $owl = $('.owl-carousel').owlCarousel({
                        items: 1,
                        loop: true
                    });
                    $owl.trigger('refresh.owl.carousel');
                }
            </script>

            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
                    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
                    crossorigin="anonymous">
            </script>
        </div>
    </body>
</html>